@*
  This Source Code Form is subject to the terms of the Mozilla Public
  License, v. 2.0. If a copy of the MPL was not distributed with this
  file, You can obtain one at http://mozilla.org/MPL/2.0/.

  Copyright Â© 2020-2021 Maxim Yudin <stibiu@yandex.ru>
*@

@inject IJSRuntime JsRuntime

<div id="@ChartSettings.ChartId-wrapper" class="chart-wrapper position-relative">
  <canvas id="@ChartSettings.ChartId" class="chart-canvas"></canvas>

  <div id="@ChartSettings.ChartId-summary" class="chart-summary container-fluid py-2">
    <div class="text-date row">
      <div class="text-right col-3 col-xl-2">
        Period start:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="period-start">???</span>
      </div>
      <div class="text-right col-3 col-xl-2">
        Period end:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="period-end">???</span>
      </div>
    </div>

    <div class="text-pressure row">
      <div class="text-right col-3 col-xl-2">
        Min pressure:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="min-pressure">???</span> PressureUnits (<span class="min-pressure-timestamp">???</span>)
      </div>
      <div class="text-right col-3 col-xl-2">
        Max pressure:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="max-pressure">???</span> PressureUnits (<span class="max-pressure-timestamp">???</span>)
      </div>
    </div>

    <div class="text-temperature row">
      <div class="text-right col-3 col-xl-2">
        Min temperature:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="min-temperature">???</span> TemperatureUnits (<span class="min-temperature-timestamp">???</span>)
      </div>
      <div class="text-right col-3 col-xl-2">
        Max temperature:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="max-temperature">???</span> TemperatureUnits (<span class="max-temperature-timestamp">???</span>)
      </div>
    </div>

    <div class="text-humidity row">
      <div class="text-right col-3 col-xl-2">
        Min humidity:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="min-humidity">???</span> HumidityUnits (<span class="min-humidity-timestamp">???</span>)
      </div>
      <div class="text-right col-3 col-xl-2">
        Max humidity:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="max-humidity">???</span> HumidityUnits (<span class="max-humidity-timestamp">???</span>)
      </div>
    </div>

    <div class="text-info statistics row">
      <div class="text-right col-3 col-xl-2">
        Entries displayed:
      </div>
      <div class="text-left col-9 col-xl-4">
        <span class="entries-count">???</span>
      </div>
    </div>
  </div>
</div>

@code
{
  /// <summary>
  ///   Defines the chart initialization function name.
  /// </summary>
  private const string ChartInitializationFunctionName = "initializeChart";

  /// <summary>
  ///   Gets or sets the chart settings object.
  /// </summary>
  [Parameter]
  public ChartSettings ChartSettings { get; set; } = new();

  /// <summary>
  ///   Gets or sets the starting timestamp of the chart.
  /// </summary>
  [Parameter]
  public DateTime PeriodStart { get; set; } = DateTime.Now - TimeSpan.FromDays(1);

  /// <summary>
  ///   Gets or sets the ending timestamp of the chart.
  /// </summary>
  [Parameter]
  public DateTime PeriodEnd { get; set; } = DateTime.Now;

  /// <summary>
  ///   Gets or sets the enumeration of climatic measurement to display.
  /// </summary>
  [Parameter]
  public IEnumerable<Measurement> Measurements { get; set; } = new List<Measurement>();

  /// <inheritdoc />
  protected override async Task OnAfterRenderAsync(bool firstRender)
  {
    try
    {
      await JsRuntime.InvokeVoidAsync(ChartInitializationFunctionName, ChartSettings.ChartId,
        ChartSettings.CreateChartJsOptions(PeriodStart, PeriodEnd, Measurements));
    }
    catch
    {
      // Suppress exceptions.
    }
  }
}
